<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<style>
body { font-family: Arial; font-size: 12px; }
h2 { background: #0a3d8c; color: white; padding: 8px; }
h3 { margin-top: 25px; }
table { width: 100%; border-collapse: collapse; margin-top: 12px; }
th, td { border: 1px solid #ccc; padding: 5px; text-align: left; }
th { background: #eee; }
.text-right { text-align: right; }
.card { border: 1px solid #999; padding: 10px; margin-top: 20px; }
</style>
</head>
<body>

<h2>Relatório — Top 3 Fracionado</h2>

<p>
<strong>Total fracionado:</strong> R$ {{ "%.2f"|format(total) }} <br>
<strong>Economia:</strong> R$ {{ "%.2f"|format(economia) }}
</p>

{% for grupo in grupos %}
<div class="card">

<h3>{{ grupo.mercado.nome }}</h3>
<p>
<strong>Cidade:</strong> {{ grupo.mercado.cidade }} <br>
<strong>Bairro:</strong> {{ grupo.mercado.bairro }} <br>
<strong>Itens nesta loja:</strong> {{ grupo.qtd_itens }} <br>
<strong>Subtotal:</strong> R$ {{ "%.2f"|format(grupo.subtotal) }}
</p>

<table>
<thead>
<tr>
<th>Produto</th>
<th>Marca</th>
<th>Unidade</th>
<th>Tam</th>
<th>Qtd</th>
<th>Preço</th>
<th>Total</th>
</tr>
</thead>
<tbody>
{% for it in grupo.itens %}
<tr>
<td>{{ it.nome }}</td>
<td>{{ it.marca }}</td>
<td>{{ it.unidade }}</td>
<td>{{ it.tamanho }}</td>
<td class="text-right">{{ it.qtd }}</td>
<td class="text-right">R$ {{ "%.2f"|format(it.preco) }}</td>
<td class="text-right">R$ {{ "%.2f"|format(it.total_linha) }}</td>
</tr>
{% endfor %}
</tbody>
</table>

</div>
{% endfor %}

</body>
</html>
